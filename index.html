<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Weather Search</h1>
<div class="container">
  <div class="row">
      <input type="text" id="city-input" class="col-md-3">
      <button type="submit" id="find-city">search</button>
</div>
<div class="row">
    <div class="col-md-3">
        <ul>
        <li id="recent-search-btns"></li>
        </ul>
      </div>
    <div class="card-body col-md-7">
      <p class="card-text"></p>
    </div>
  </div>
</div> 
</div> 
    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){
  // .on("click") function will trigger AJAX call
// $(document).ready(function(){

var cityArray = []
var city = $("#city-input").val().trim();

$("#find-city").on("click", function(e){
  e.preventDefault();
  var city = $("#city-input").val().trim();
  localStorage.setItem("city", city);
  cityArray.push(city);
  renderButtons();
  todayWeather(city);
  forecast(city);
});

function renderButtons(){
  $("#recent-search-btns").empty();
  for(var i=0; i<cityArray.length; i++){
    var a = $("<button>");
      a.addClass("city");
      a.attr("find-city", cityArray[i]);
      a.text(cityArray[i]);
      $("#recent-search-btns").append(a);
  }
};
  
function todayWeather(city){
  var city = $("#city-input").val();
  // var apiKey = "166a433c57516f51dfab1f7edaed8413";
  var todayURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&appid=f14b6a45063b423ef9b28d528efca1a9&units=imperial";
  // get lat and lon
  $.ajax({
    url: todayURL,
    method: "GET"
  }).then(function(response) {
    console.log(response);

    var tempTag = $("<p>").text(response.main.temp);
    var humidityTag = $("<p>").text(response.main.humidity);
      console.log(humidityTag);
    var windSpeedTag = $("<p>").text(response.wind.speed);
    var dateTag = $("<p>").text(response.name + new Date().toLocaleDateString());
    var imgTag = $("<img>").attr("src", "http://openweathermap.org/img/w/" + response.weather[0].icon + ".png");

    $(".card-body").append(tempTag, humidityTag, windSpeedTag, dateTag, imgTag);

    // $(".list-group-item").empty();  
    var lat = response.coord.lat;
    var lon = response.coord.lon;

  uvIndex(lat, lon);
})
};

function uvIndex(lat, lon){
    var uvURL = "http://api.openweathermap.org/data/2.5/uvi?appid=166a433c57516f51dfab1f7edaed8413&lat=" + lat + "&lon=" + lon;
    $.ajax({
    url: uvURL,
    method: "GET"
  }).then(function(response) {
    console.log(response);
  var uvTag = $("<p>").text("uvindex:");
  var uvBtn = $("<span>").addClass("btn btn-sm").text(response.value);
    if(response.value < 3){
      uvBtn.addClass("btn-success");
    } else if(response.value < 7){
      uvBtn.addClass("btn-warning");
    } else {
      uvBtn.addClass("btn-danger");
    }
    $(".card-body").append(uvTag.append(uvBtn));

    forecast(city);
  })
};

  
  function forecast(city){
    var city = $("#city-input").val();
    console.log("yes");
    var fiveDayURL = "http://api.openweathermap.org/data/2.5/forecast?q=" + city + "&appid=166a433c57516f51dfab1f7edaed8413";
   
    $.ajax({
    url: fiveDayURL,
    method: "GET"
    }).then(function(response) {
    console.log(response);

    response.list.forEach(function(day){
      console.log(day)
    for(var i = 0; i<response.list.length; i++){
    var tempTag = $("<p>").text(response.list[i].main.temp);
    var humidityTag = $("<p>").text(response.list[i].main.humidity);
      console.log(humidityTag);
    var windSpeedTag = $("<p>").text(response.list[i].wind.speed);
    var dateTag = $("<p>").text(response.city.name + new Date().toLocaleDateString());
    var imgTag = $("<img>").attr("src", "http://openweathermap.org/img/w/" + response.list[i].weather[0].icon + ".png");

    $(".card-body").append(tempTag, humidityTag, windSpeedTag, dateTag, imgTag);
    }
    // $(".list-group-item").empty();  
    // var lat = response.coord.lat;
    // var lon = response.coord.lon;

  // uvIndex(lat, lon);
  }) })}
  })
  

// // function recallSearch(e){
// // e.preventDefault();
// localStorage.clear()
// // }



  </script>
</body>
</html>

